# Getting Started

## Installation

### With uv (recommended)

```bash
# Create a new project
uv init my-calculator
cd my-calculator

# Add pe-compile with UK model support
uv add pe-compile[uk]

# Or with US model support
uv add pe-compile[us]
```

### With pip

```bash
pip install pe-compile[uk]
# or
pip install pe-compile[us]
```

## Basic Usage

### Command Line

```bash
# Compile a single variable
pe-compile -c uk -v income_tax --year 2024 -o uk_tax.py

# Compile multiple variables
pe-compile -c uk -v income_tax,national_insurance --year 2024 -o uk_calc.py

# Dry run - see what will be compiled
pe-compile -c uk -v income_tax --dry-run
```

### Output

```
Compiling for year 2024...
Analyzing 1 variable(s)...
Found 15 variable(s), 8 parameter path(s)
Extracting parameter values...
Extracted 8 parameter value(s)
Generating standalone calculator...
Written to uk_tax.py
Code size: 3,456 bytes
```

### Using Generated Code

```python
from uk_tax import calculate

# Single calculation
result = calculate(employment_income=50000)
print(f"Income tax: Â£{result['income_tax']:,.2f}")

# Batch calculation
import numpy as np

incomes = np.random.uniform(20000, 150000, 1000)
for income in incomes:
    result = calculate(employment_income=income)
```

## Python API

For more control, use the Python API directly:

```python
from pe_compile import CodeGenerator

generator = CodeGenerator()

# Add input variables
generator.add_input_variable("gross_income", default_value=0)
generator.add_input_variable("pension_contributions", default_value=0)

# Add computed variables with formulas
generator.add_variable(
    name="taxable_income",
    formula_source='''
def formula(person, period):
    gross = person("gross_income", period)
    pension = person("pension_contributions", period)
    return max(gross - pension - 12570, 0)
''',
    dependencies=["gross_income", "pension_contributions"],
)

# Add parameters (frozen for specific year)
generator.add_parameter("gov.hmrc.income_tax.rates.basic", 0.20)

# Generate standalone module
code = generator.generate_module()
print(code)
```

## Year-Specific Compilation

Parameters change over time. Use `--year` to compile for a specific tax year:

```bash
# 2024 tax year
pe-compile -c uk -v income_tax --year 2024 -o uk_tax_2024.py

# 2023 tax year (different thresholds)
pe-compile -c uk -v income_tax --year 2023 -o uk_tax_2023.py
```

The generated code includes metadata about the compilation:

```python
"""
Standalone calculator compiled from PolicyEngine UK.

Generated by pe-compile v0.1.0
Year: 2024
Target variables: income_tax
Total variables: 15
Parameters: 8
"""
```

## Limitations

- **Snapshot in time**: Generated code has parameters frozen at a specific date
- **Subset only**: Only includes variables you explicitly request (plus dependencies)
- **No reforms**: Reform system not yet supported
- **Single entity**: Currently focused on person-level calculations

## Next Steps

- See [Benchmarks](benchmarks) for performance comparisons
- See [API Reference](api) for detailed documentation
